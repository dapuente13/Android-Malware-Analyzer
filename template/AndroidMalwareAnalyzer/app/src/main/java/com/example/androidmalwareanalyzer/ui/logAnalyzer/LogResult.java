package com.example.androidmalwareanalyzer.ui.logAnalyzer;

import android.graphics.drawable.Drawable;

import java.util.ArrayList;
import java.util.Collections;

public class LogResult {
    private ArrayList<LogInteractions> logs_result_list;

    public class LogInteractions implements Comparable<LogInteractions> {
        private String element = "";
        private String appname = "";
        private Drawable icon;
        private int total_interactions = 0;
        private int suspicious_interactions = 0;

        public void setElement(String element) { this.element = element; }
        public String getElement() { return element; }
        public String getAppName() {
            return appname;
        }
        public void setAppName(String appName) { appname = appName; }
        public Drawable getAppIcon() {
            return icon;
        }
        public void setAppIcon(Drawable appIcon) {
            icon = appIcon;
        }
        public int getTotal_interactions() { return total_interactions; }
        public void setTotal_interactions(int total_interactions) { this.total_interactions = total_interactions; }
        public void addTotal_interactions(int total_interactions) { this.total_interactions += total_interactions; }
        public int getSuspicious_interactions() { return suspicious_interactions; }
        public void setSuspicious_interactions(int suspicious_interactions) { this.suspicious_interactions = suspicious_interactions; }
        public void addSuspicious_interactions(int suspicious_interactions) { this.suspicious_interactions += suspicious_interactions; }

        @Override
        public int compareTo(LogInteractions o) {
            if (total_interactions == o.getTotal_interactions())
                return 0;
            else if (total_interactions > o.getTotal_interactions())
                return -1;
            else
                return 1;
        }
    }

    public LogResult(String msg) {
        logs_result_list = new ArrayList<LogInteractions>();
        parseResult(msg);
    }

    public void parseResult(String msg) {
        boolean found = false;
        //D OverallOptimization 20
        String[] msg_lines = msg.split("\n");

        for (int i = 0; i < msg_lines.length; ++i) {
            String[] msg_values = msg_lines[i].split(" ");
            found = false;

            for (int j = 0; j < logs_result_list.size() && !found; ++j) {
                if (logs_result_list.get(j).getElement().equals(msg_values[1])) {
                    found = true;
                    if (msg_values[0].equals("W") || msg_values[0].equals("E") || msg_values[0].equals("F"))
                        logs_result_list.get(j).addSuspicious_interactions(Integer.parseInt(msg_values[2]));
                    logs_result_list.get(j).addTotal_interactions(Integer.parseInt(msg_values[2]));
                }
            }

            if (!found) {
                LogInteractions new_element = new LogInteractions();
                new_element.setElement(msg_values[1]);

                if (msg_values[0].equals("W") || msg_values[0].equals("E") || msg_values[0].equals("F"))
                    new_element.setSuspicious_interactions(Integer.parseInt(msg_values[2]));
                new_element.setTotal_interactions(Integer.parseInt(msg_values[2]));

                logs_result_list.add(new_element);
            }
        }

        Collections.sort(logs_result_list);
    }

    public String returnResult() {
        String msg = "";
        int suspicious_number, total_number;

        for (int i = 0; i < logs_result_list.size(); ++i) {
            suspicious_number = logs_result_list.get(i).getSuspicious_interactions();
            total_number = logs_result_list.get(i).getTotal_interactions() - suspicious_number;

            if (suspicious_number != 0)
                msg += "W " + logs_result_list.get(i).getElement() + " " + suspicious_number + "\n";

            if (total_number != 0)
                msg += "I " + logs_result_list.get(i).getElement() + " " + total_number + "\n";
        }

        return msg;
    }

    public ArrayList<LogInteractions> getList() { return logs_result_list; }
}
